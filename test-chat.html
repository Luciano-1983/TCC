<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .chat-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            background-color: #f9f9f9;
        }
        .message {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .sent {
            background-color: #d4edda;
            text-align: right;
        }
        .received {
            background-color: #d1ecf1;
        }
        input, button {
            margin: 5px;
            padding: 8px;
        }
        .status {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Teste do Sistema de Chat</h1>
    
    <div class="chat-container">
        <h2>Usuário (ID: 1)</h2>
        <div id="user-status" class="status">Conectando...</div>
        <div class="messages" id="user-messages"></div>
        <input type="text" id="user-input" placeholder="Digite sua mensagem...">
        <button onclick="sendUserMessage()">Enviar para Profissional</button>
    </div>

    <div class="chat-container">
        <h2>Profissional (ID: 2)</h2>
        <div id="professional-status" class="status">Conectando...</div>
        <div class="messages" id="professional-messages"></div>
        <input type="text" id="professional-input" placeholder="Digite sua mensagem...">
        <button onclick="sendProfessionalMessage()">Enviar para Usuário</button>
    </div>

    <script>
        const socket = io();
        let userConnected = false;
        let professionalConnected = false;

        // Conectar usuário
        socket.emit('login', { userId: 1, type: 'user' });
        
        // Conectar profissional
        setTimeout(() => {
            socket.emit('login', { userId: 2, type: 'professional' });
        }, 1000);

        socket.on('connect', () => {
            console.log('Conectado ao servidor');
        });

        socket.on('login', (data) => {
            if (data.type === 'user') {
                userConnected = true;
                document.getElementById('user-status').textContent = 'Conectado como Usuário';
            } else if (data.type === 'professional') {
                professionalConnected = true;
                document.getElementById('professional-status').textContent = 'Conectado como Profissional';
            }
        });

        socket.on('receive_message', (data) => {
            console.log('Mensagem recebida:', data);
            
            if (data.type === 'user') {
                // Profissional recebe mensagem do usuário
                addMessage('professional-messages', `${data.fromUserName}: ${data.message}`, 'received');
            } else if (data.type === 'professional') {
                // Usuário recebe mensagem do profissional
                addMessage('user-messages', `${data.fromProfessionalName}: ${data.message}`, 'received');
            }
        });

        function sendUserMessage() {
            const message = document.getElementById('user-input').value;
            if (message.trim() && userConnected) {
                socket.emit('send_message', {
                    fromUserId: 1,
                    toProfessionalId: 2,
                    message: message,
                    fromUserName: 'Usuário Teste'
                });
                addMessage('user-messages', `Você: ${message}`, 'sent');
                document.getElementById('user-input').value = '';
            }
        }

        function sendProfessionalMessage() {
            const message = document.getElementById('professional-input').value;
            if (message.trim() && professionalConnected) {
                socket.emit('send_professional_message', {
                    fromProfessionalId: 2,
                    toUserId: 1,
                    message: message,
                    fromProfessionalName: 'Profissional Teste'
                });
                addMessage('professional-messages', `Você: ${message}`, 'sent');
                document.getElementById('professional-input').value = '';
            }
        }

        function addMessage(containerId, message, type) {
            const container = document.getElementById(containerId);
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Permitir envio com Enter
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendUserMessage();
            }
        });

        document.getElementById('professional-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendProfessionalMessage();
            }
        });
    </script>
</body>
</html> 